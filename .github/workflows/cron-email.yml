name: Email Scheduler

on:
  schedule:
    # Run every 5 minutes to check for reminders (GitHub minimum frequency)
    - cron: "*/5 * * * *"
  workflow_dispatch: # Allow manual trigger

jobs:
  check-reminders:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies
        run: npm install

      - name: Check and send reminders
        run: |
          cat > .env.production << 'EOF'
          FIREBASE_PROJECT_ID=prsnl-897c2
          FIREBASE_CLIENT_EMAIL=firebase-adminsdk-fbsvc@prsnl-897c2.iam.gserviceaccount.com
          FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC6U7Bp5gskygnG\n50LgKQ0iKwXvE38cmEL4fta+HKWu7oyyO+FY1zCNjiMZZyts49NQgIPlpJkVhbu9\nnNK826sIWgGoxuckMfMb8zrSUxjZ96nLEeIW2Yqnf6+LUmExHXrj9zeK8x+MUVEd\nab9reWG6evexY9ulBUiQjy27/Zza4FY2KK8vbM+dHaiSoRfeZ6AVKORS87KAcrn6\nHhWvQtUsAg92Cw9JB9sqvPfHB4UWA8zcIy2z1/c/tSBJFMtq1wOs8FdrJCvp37JK\n0ow972Og6cnxaGemuJxK2gaRI+6EAxnTCnp89bPiu/qfy0S1a0T2nbKEguzXHd+g\nysfurxURAgMBAAECggEADO4p2+9+7nqm2wrJdUzkAG8D5mdv9sgKPbxvopnSVaVw\nVh4ZsVSdpfUrMmQae2AEFh4VCSa3COtS8AGmDj0gTWARpWjIOZbNzC7A8j+aBeZN\n/i2rhvJp0N3njL+WxxXIpXFOhXIByncKLgRcqFSwF4TZE5Jed8E6G+4TumwLKpUw\ndg6fURVw6DbZjPhIfv4E+VpXwHKYM+1VhT4kVFLHyWfeVhTpJzJT9XGq3vNqKa+p\nAL5T/h8GQ+cmG9yYRXBNyACSOwQ8KlzDCJN5se6PG0f8a4rc+9QoxlkSoEKX8Hh2\nDgdXgu+tNlRniu72wIwwqiBOhonaV59Jcm77Cd1r0QKBgQDvPRiuxeA7liKxjXTF\nbXIORkIQV9Grf32g1Ft74y7O0sfn8LQUXTRNeKk2yPMMau70HX9ekoYb+bRigOCi\nMO0BAc808td5Pf2TOY5E8Tg66nZ7qjtM/Lgoi8wN74OJpVSPMkhAVP+Ljk9lspq+\n5x4bsOfwU2myxjs8+DsN5pYnUwKBgQDHYZXkDzhCNAZZMo0OQqk+iV4Y8jhH7miF\nTS5caqL9yD9Y8egFuPiGuoqeDxAheMT9pa95xYMku+dpLgvZ24rQcSHo2o2Wmytx\nZgIuOna04UfeLYyKMFq0cxLeqeN6iY0Tm0bBkg4D95HaFgbGOjWtTqlWohrA2aGB\ndsdBwHj5iwKBgDbhcxoUtn200Tyd0J3Bn5p6r4kEPEr1MiKE1H+0+/XiEI26f/Tz\n9J2ZAmhY7Lh6h1pkseVGA5HDVIgMPHu4cYX7nkbtNlTPza3KVEKoe1e4lXmE8ZmV\nl8FlYGgJ+8jFroIy7LQlS4H+IWSY9jq41gVQLcTJvcOPCePQpetobCWVAoGALQKn\nvvt8nN13zW0vENgVswt51bHg6MQ2jllVLQHZ1+b7/g1mbtxKJsg4AOSvpI7KEeT0\nj036hDFzVXhSrpT0aogPuqyUKDrRfOElfuAt6jmtasfnoU63O2N7EA9UTlZ9Jb75\nIzvgtB6Qq6YrU1bSxVQrwGYKGh1Ha52v7/UOmm8CgYATlxhGK//L1RYl3MU56LEv\nXqM6xwXdCj6HVRm2V4qJ/hGJc9Ty/2y9aREo39/8Eu6u3P6WImzzkYnplHG27Wh/\nzq+YcKDt9f/dl/VXFZ3x9+SEYgx4uhij5Y2rVQfTeI2c1e7F8yZXASrWGHmqJxSO\nbWlVxFOAevwlrADmIZDFRg=="
          EMAIL_USER=9dde52001@smtp-brevo.com
          EMAIL_PASS=xsmtpsib-2dd233f752b8e61363ad7e66ecdc73591fe0ba3f72aa3d91343d6329a70a1998-rf8HXGRVq5zyKoj7
          EMAIL_HOST=smtp-relay.brevo.com
          EMAIL_PORT=587
          EMAIL_FROM=jerinthomas1235@gmail.com
          NODE_ENV=production
          EOF
          node --eval "import('./server/src/cron/scheduler.js').then(m => m.startScheduler()).catch(e => { console.error(e); process.exit(1); })"
