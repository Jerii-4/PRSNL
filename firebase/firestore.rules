rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // 1. Default Security: Deny all reads and writes unless explicitly allowed below.
    // This is a secure baseline, forcing you to define permissions for everything.
    match /{document=**} {
      allow read, write: if false;
    }

    // 2. Users Collection:
    // A user can read and write their own user profile document.
    // Path example: /users/someAuthUID
    match /users/{userId} {
      allow read, write: if request.auth.uid == userId;

      // 3. User's Notes Subcollection:
      // A user can read and write notes stored as a subcollection under their user document.
      // Path example: /users/someAuthUID/notes/someNoteID
      match /notes/{noteId} {
        // The 'userId' from the parent match is in scope here.
        allow read, write: if request.auth.uid == userId;
      }
    }

    // --- Add rules for other top-level collections or subcollections here ---

    // Example: A public 'posts' collection where anyone can read, but only authenticated users can write.
    // match /posts/{postId} {
    //   allow read: if true; // Publicly readable
    //   allow write: if request.auth != null && request.auth.uid == request.resource.data.authorId; // Only author can write
    // }

    // Example: A 'settings' collection that only administrators can access.
    // This would require custom claims set on the user's authentication token.
    // match /settings/{settingId} {
    //   allow read, write: if request.auth.token.admin == true;
    // }

  }
}
